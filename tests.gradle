/* Supporting docker tasks for backend tests */
String containerName = "backendContainer"

dockerRun {
    name=containerName
    image 'jqpoon/arm_compile_emulate:working'
    arguments '-t', '-v', '/Users/JiaQi/Desktop/:/compile/src:ro'
}

task dockerStopAndRemove(type: Exec) {
    commandLine 'docker', 'stop', '-t', '1', containerName
    finalizedBy(dockerRemoveContainer)
}

/* Frontend tests */
test {
    useJUnitPlatform()
}

task frontendValidTest(type: Test) {
    useJUnitPlatform {
        includeTags 'valid'
    }
    testLogging {
        events "PASSED", "SKIPPED", "FAILED"
    }
}

task frontendInvalidSyntaxTest(type: Test) {
    useJUnitPlatform {
        includeTags 'invalid'
    }
    testLogging {
        events "PASSED", "SKIPPED", "FAILED"
    }
}

/* Backend tests */
task backendTest(type: Test) {
    useJUnitPlatform {
        includeTags 'backend'
    }
    dependsOn(tasks.dockerRun)
    finalizedBy(dockerStopAndRemove)
}
